import{c,a as n,b as E,w as Y,F as L,r as dt,o as r,d as tt,e as at,f as Q,g as P,u as C,s as ot,h as x,i as G,j as R,k as T,l as q,v as z,m as J,t as _,n as vt,p as ct,q as mt,x as yt,y as kt,z as wt,A as $t}from"./vendor.dc90c88f.js";const Ct=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function e(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerpolicy&&(d.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?d.credentials="include":s.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(s){if(s.ep)return;s.ep=!0;const d=e(s);fetch(s.href,d)}};Ct();const Ft=tt("Main"),St=tt("Products"),bt=tt("Cooked"),It=tt("Total"),Dt=n("footer",null," \xA9 Andrey Evtushenko, 2022 ",-1),Lt={setup(a){function t(e){e.target.classList.add("current")}return(e,l)=>{const s=dt("router-link"),d=dt("router-view");return r(),c(L,null,[n("nav",{onClick:l[0]||(l[0]=v=>t(v))},[E(s,{id:"main-link",to:"/"},{default:Y(()=>[Ft]),_:1}),E(s,{id:"prod-link",to:"/products"},{default:Y(()=>[St]),_:1}),E(s,{id:"cook-link",to:"/cooked"},{default:Y(()=>[bt]),_:1}),E(s,{id:"tot-link",to:"/total"},{default:Y(()=>[It]),_:1})]),E(d,{name:"DatePicker"}),E(d),E(d,{name:"DayStat"}),E(d,{name:"ProductList"}),E(d,{name:"CookedList"}),Dt],64)}}};var V={baseURL:"",options:{method:"",headers:{"Content-Type":"application/json"},body:""},async post(a,t){return this.options.method="POST",this.options.body=JSON.stringify(t),await this.send(a)},async patch(a,t){return this.options.method="PATCH",this.options.body=JSON.stringify(t),await this.send(a)},async send(a){const t=await fetch(this.baseURL+a,this.options);return t.ok||console.log("HTTP-Error:",t.status),t.json()},async get(a){return(await fetch(this.baseURL+a)).json()},async delete(a){const t=await fetch(this.baseURL+a,{method:"DELETE"});return t.ok?await t.json():(console.log("HTTP-Error:",t.status),t.ok)}},lt=at("storeId",{state(){return{pickedDate:new Date,dayStat:[],foodAddedFlag:!1}},getters:{getDayStatId(){const a=this.dayStat.length;if(a){const t=a-1;return this.dayStat[t].dayStatId+1}return 0},pickedDateString(){return this.pickedDate.toDateString()}}});const Vt={class:"date-picker"},xt={setup(a){const t=lt();Q(()=>{e()}),P(()=>t.pickedDateString,(l,s)=>{l!=s&&e()});async function e(){const s=`/api/daystat/${t.pickedDateString}`,d=await V.get(s);t.dayStat=d}return(l,s)=>(r(),c("div",Vt,[E(C(ot),{modelValue:C(t).pickedDate,"onUpdate:modelValue":s[0]||(s[0]=d=>C(t).pickedDate=d),"input-format":"yyyy MMM dd"},null,8,["modelValue"])]))}};const Pt={class:"food-form"},Tt={class:"header"},Nt=n("span",{class:"indent"},null,-1),Rt={key:0,class:"matches"},Ut={key:1,class:"matches"},Et=["onClick"],Mt={setup(a){const t=lt(),e=x(null),l=x(null),s=x(""),d=x(""),v=x([]),k=G({id:null,name:null,weight:null,kcal_1:null,proteins_1:null,fats_1:null,carbohydrates_1:null}),N=["Kcal","Prots","Fats","Carbs"];Q(()=>{e.value.focus(),document.getElementById("main-link").classList.add("current")});const F=R(()=>v.value.length==0&&s.value.length>1&&!k.id),S=R(()=>v.value.map(i=>w(i))),b=R(()=>I.value?h():["-","-","-","-"]),I=R(()=>!!(k.id&&k.weight>0));function w(i){const y={id:i.id};if(i.date){const g=new Date(Date.parse(i.date)).toDateString();y.foodNameDate=`${i.name} [ ${g} ]`,y.name=i.name}else y.foodNameDate=i.name,y.name=i.name;return y}function h(){return{kcal:+(k.kcal_1*k.weight).toFixed(2),proteins:+(k.proteins_1*k.weight).toFixed(2),fats:+(k.fats_1*k.weight).toFixed(2),carbohydrates:+(k.carbohydrates_1*k.weight).toFixed(2)}}function u(){if(k.id)for(let i in k)k[i]=null}async function m(){if(s.value.length<2){v.value=[];return}else{const i=s.value;v.value=await V.get(`/api/food/matches/${i}`)}}function D(){let i=d.value;if(i=parseFloat(i),isNaN(i)){d.value=null,k.weight=null;return}k.weight=i}function W(i){k.id=i.id,k.name=i.name,s.value=i.name,v.value=[],l.value.focus(),O(i.id),D()}async function O(i){const y=await V.get(`/api/food/data/${i}`);Object.assign(k,y)}async function j(){!I.value||!await H()||(K(),u(),A(),e.value.focus())}async function H(){const i={date:t.pickedDateString,dayStatId:t.getDayStatId,foodId:k.id,weight:k.weight};return await V.post("/api/daystat",i)}function K(){const i={dayStatId:t.getDayStatId,name:k.name,weight:k.weight};Object.assign(i,b.value),t.dayStat.push(i),t.foodAddedFlag=!0}function A(){s.value="",d.value=""}return(i,y)=>(r(),c("div",Pt,[n("div",Tt,[Nt,(r(),c(L,null,T(N,g=>n("span",null,_(g),1)),64))]),q(n("input",{class:"name",type:"text",ref_key:"foodNameInputRef",ref:e,placeholder:"food name",maxlength:"64",onInput:y[0]||(y[0]=g=>(u(),m())),"onUpdate:modelValue":y[1]||(y[1]=g=>s.value=g)},null,544),[[z,s.value]]),q(n("input",{class:"weight",type:"text",ref_key:"weightInputRef",ref:l,placeholder:"food weight",maxlength:"4",onInput:D,"onUpdate:modelValue":y[2]||(y[2]=g=>d.value=g)},null,544),[[z,d.value]]),(r(!0),c(L,null,T(C(b),g=>(r(),c("span",null,_(g),1))),256)),C(F)?(r(),c("p",Rt,"No matches found")):J("",!0),v.value.length>0?(r(),c("ul",Ut,[(r(!0),c(L,null,T(C(S),g=>(r(),c("li",{onClick:U=>W(g)},_(g.foodNameDate),9,Et))),256))])):J("",!0),n("div",{class:"form-buttons"},[n("button",{onClick:j}," Submit ")])]))}};const Wt={key:0,class:"day-stat"},Bt={key:1,class:"day-stat"},Ot={class:"header"},At=n("span",{class:"indent"},null,-1),jt={class:"food-item"},Ht={class:"food-name"},Kt=["onClick"],qt=n("hr",null,null,-1),zt={class:"total-stat"},Jt=n("span",{class:"header"},"Total:",-1),Gt={class:"value"},Zt={setup(a){const t=lt(),e=G({kcal:0,proteins:0,fats:0,carbohydrates:0}),l=["Weight","Kcal","Prots","Fats","Carbs"];let s=!1;P(()=>t.foodAddedFlag,w=>{if(!w)return;const h=t.pickedDateString;b(),t.dayStat.length==1?V.post(`/api/totalstat/${h}`,e):V.patch(`/api/totalstat/${h}`,e),t.foodAddedFlag=!1}),P(()=>t.pickedDateString,(w,h)=>{w!=h&&F()}),P(()=>t.dayStat,async()=>{t.dayStat.length&&!s?await d():s=!1});async function d(){const w=t.pickedDateString,h=await V.get(`/api/totalstat/${w}`);return h.length?(Object.assign(e,h[0]),!0):!1}async function v(w){const h=t.pickedDateString,u=w.dayStatId;await k(h,u)!=0&&(N(u),I(w),t.dayStat.length?V.patch(`/api/totalstat/${h}`,e):V.delete(`/api/totalstat/${h}`))}function k(w,h){const u=`/api/daystat/${w}/${h}`;return V.delete(u)}function N(w){t.dayStat=t.dayStat.filter(h=>h.dayStatId!=w),s=!0}function F(){for(let w in e)e[w]=0}function S(){for(let w in e)e[w]=+e[w].toFixed(2)}function b(){const w=t.dayStat.length,h=t.dayStat[w-1];for(let u in e)e[u]+=h[u];S()}function I(w){for(let h in e)e[h]-=w[h];w=null,S()}return(w,h)=>(r(),c(L,null,[C(t).dayStat.length?J("",!0):(r(),c("p",Wt," No eaten food on this date ")),C(t).dayStat.length?(r(),c("div",Bt,[n("div",Ot,[At,(r(),c(L,null,T(l,u=>n("span",null,_(u),1)),64))]),(r(!0),c(L,null,T(C(t).dayStat,u=>(r(),c("div",jt,[n("span",Ht,_(u.name),1),n("span",null,_(u.weight),1),n("span",null,_(u.kcal),1),n("span",null,_(u.proteins),1),n("span",null,_(u.fats),1),n("span",null,_(u.carbohydrates),1),n("button",{onClick:m=>v(u)},"Delete",8,Kt)]))),256)),qt,n("div",zt,[Jt,(r(!0),c(L,null,T(C(e),u=>(r(),c("span",Gt,_(u),1))),256))])])):J("",!0)],64))}};var ft=at("productsId",{state(){return{products:[],productFilter:"",editableProduct:{},editProductFlag:!1,scrollToBottomFlag:!1}},getters:{filteredProducts(){return this.productFilter.length>1?this.products.filter(a=>{const t=a.name.toLowerCase(),e=this.productFilter.toLocaleLowerCase();return t.includes(e)}):this.products}}});const Qt={class:"product-form"},Xt={class:"header"},Yt=n("span",{class:"indent"},null,-1),te={class:"nutr-value-header"},ee=["onInput","onUpdate:modelValue"],ne={class:"form-buttons"},oe={class:"result-message"},se=n("hr",null,null,-1),ae={setup(a){const t=ft(),e=x(null),l=x(""),s=G({kcal:"",proteins:"",fats:"",carbohydrates:""});let d={};const v=["Kcal","Prots","Fats","Carbs"],k=x("Submit"),N=x("Clean"),F=x("");Q(()=>{e.value.focus(),document.getElementById("prod-link").classList.add("current"),t.editProductFlag=!1}),P(()=>F.value,f=>{f&&setTimeout(()=>F.value="",2e3)}),P(()=>t.editProductFlag,f=>{if(!f){k.value="Submit",N.value="Clean";return}b(),k.value="Save",N.value="Cancel"});const S=R(()=>{const f={name:l.value,date:new Date().toDateString()};for(let o in s)f[o+"_1"]=s[o]/100;return f});function b(){l.value=t.editableProduct.name;for(let f in s)s[f]=t.editableProduct[f]}function I(f,o){let p=s[f];if(p=w(f,p,o),isNaN(parseFloat(p))){s[f]="";return}h(p)&&(p=o),u(p)?p=m(p,o):p=D(p),p=W(f,p),s[f]=p}function w(f,o,p){return f=="kcal"&&o.length>6||f!="kcal"&&o.length>5?(p=p.toString(),p):o}function h(f){let o=0,p=-1;for(;(p=f.indexOf(".",p+1))!=-1;)o++;return o>1}function u(f){const o=f.length-1;return f[o]=="."}function m(f,o){return o=o.toString(),o.length<f.length?f=parseFloat(o):f=parseFloat(f),f<100&&(f+="."),f}function D(f){let o=f.length;f=parseFloat(f);let p=f.toString().length;return o-p>1&&(f+="."),f}function W(f,o){return f=="kcal"&&o>999.99?999.99:f!="kcal"&&o>100?100:o}async function O(){!j()||(t.editProductFlag?H():U())}function j(){return l.value==""||S.value.kcal_1==0?(F.value="Not enough information provided",!1):!0}async function H(){if(!K()){F.value="No changes were made";return}await A()?(F.value="Changes saved",i(),y(),g()):F.value="Changes weren't saved"}function K(){let f=!1;l.value!=t.editableProduct.name&&(f=!0,d.name=l.value);for(let o in s)s[o]!=t.editableProduct[o]&&(f=!0,d[o]=s[o].toFixed(2));return f}function A(){const o=`/api/product/${t.editableProduct.id}`;return V.patch(o,S.value)}function i(){Object.assign(t.editableProduct,d)}function y(){d={},t.editableProduct={},t.editProductFlag=!1}function g(){l.value="";for(let f in s)s[f]=""}async function U(){const f=await B();f>0?(F.value="Product was added",et(f),g()):F.value="Product wasn't added"}function B(){const f="/api/product";return V.post(f,S.value)}function et(f){const o=nt(f);t.products.push(o),t.scrollToBottomFlag=!0}function nt(f){const o={id:f,name:l.value};for(let p in s)o[p]=(+s[p]).toFixed(2);return o}function Z(){t.editProductFlag&&y(),g()}return(f,o)=>(r(),c("div",Qt,[n("div",Xt,[Yt,(r(),c(L,null,T(v,p=>n("span",te,_(p),1)),64))]),q(n("input",{class:"name",type:"text",ref_key:"productNameInputRef",ref:e,placeholder:"product name",maxlength:"64","onUpdate:modelValue":o[0]||(o[0]=p=>l.value=p)},null,512),[[z,l.value]]),(r(!0),c(L,null,T(C(s),(p,$)=>q((r(),c("input",{class:"nutr-value-input",type:"text",onInput:X=>I($,p),"onUpdate:modelValue":X=>C(s)[$]=X},null,40,ee)),[[z,C(s)[$]]])),256)),n("div",ne,[n("button",{onClick:O},_(k.value),1),n("button",{onClick:Z},_(N.value),1)]),n("p",oe,_(F.value),1),se]))}};const le={class:"product-list-buttons"},ie={key:0},ue={key:1,class:"products"},re={class:"header"},de={class:"product-name"},ce={class:"nutr-value-header"},fe={key:0},he={key:1,class:"list"},pe={class:"product-name"},ge=["onClick"],_e=["onClick"],ve={setup(a){const t=ft(),e=x("Show products"),l=x(null),s=x(""),d=["Kcal","Prots","Fats","Carbs"],v=R(()=>!t.products.length),k=R(()=>!t.filteredProducts.length);P(v,h=>{h?e.value="Show products":e.value="Reload"}),P(l,h=>{h&&l.value.focus()}),P(()=>t.productFilter.length,h=>{h>1&&t.filteredProducts.length==0&&(s.value="No such product")}),P(s,h=>{h&&setTimeout(()=>s.value="",2e3)}),vt(()=>{t.scrollToBottomFlag&&F(),t.scrollToBottomFlag=!1});async function N(){const h=await V.get("/api/products");h.length?t.products=S(h):s.value="There are no products"}function F(){const h=document.body.scrollHeight;scrollTo(0,h)}function S(h){for(let u of h)for(let m in u){if(m=="id"||m=="name")continue;const D=m.replace("_1","");u[D]=+(u[m]*100).toFixed(2),delete u[m]}return h}function b(h){t.editableProduct=h,t.editProductFlag=!0}async function I(h){if(!confirm("Do you really want delete it?"))return;const m=`/api/product/${h.id}`,D=await V.delete(m);D=="ER_ROW_IS_REFERENCED"?alert("Can't be deleted due to presence as ingridient or in eaten food"):D==1&&w(h)}function w(h){t.products=t.products.filter(u=>u!=h)}return(h,u)=>(r(),c(L,null,[n("div",le,[n("button",{onClick:N},_(e.value),1),n("button",{onClick:F}," Scroll to bottom ")]),C(v)?(r(),c("p",ie,_(s.value),1)):(r(),c("div",ue,[n("div",re,[n("span",de,[q(n("input",{class:"filter",type:"text",ref_key:"productFilterInputRef",ref:l,placeholder:"filter...","onUpdate:modelValue":u[0]||(u[0]=m=>C(t).productFilter=m)},null,512),[[z,C(t).productFilter]])]),(r(),c(L,null,T(d,m=>n("span",ce,_(m),1)),64))]),C(k)?(r(),c("p",fe," No such products ")):(r(),c("div",he,[(r(!0),c(L,null,T(C(t).filteredProducts,m=>(r(),c("div",{class:"product",key:m.food_id},[n("span",pe,_(m.name),1),n("span",null,_(m.kcal),1),n("span",null,_(m.proteins),1),n("span",null,_(m.fats),1),n("span",null,_(m.carbohydrates),1),n("button",{onClick:D=>b(m)}," Edit ",8,ge),n("button",{onClick:D=>I(m)}," Delete ",8,_e)]))),128))]))]))],64))}};var ht=at("cookedId",{state(){return{cookedFormHeight:289,editableCooked:{},editCookedFlag:!1,baseCookedFlag:!1,cookedList:[]}},getters:{}});const me={class:"food-list"},ye={class:"food-list-header"},ke=n("span",{class:"food-name"},null,-1),we={class:"food-item"},$e={class:"food-name"},Ce={props:["foodList"],setup(a){const t=a,e=["Weight","Kcal","Prots","Fats","Carbs"],l=R(()=>{if(t.foodList)return t.foodList.map(s=>{const d={};for(let v in s)if(v.includes("_1")){const k=v.replace("_1","");d[k]=+(s[v]*s.weight).toFixed(2)}else d[v]=s[v];return d})});return(s,d)=>(r(),c("div",me,[n("div",ye,[ke,(r(),c(L,null,T(e,v=>n("span",null,_(v),1)),64))]),(r(!0),c(L,null,T(C(l),v=>(r(),c("div",we,[n("span",$e,_(v.name),1),n("span",null,_(v.weight),1),n("span",null,_(v.kcal),1),n("span",null,_(v.proteins),1),n("span",null,_(v.fats),1),n("span",null,_(v.carbohydrates),1)]))),256))]))}};const Fe={class:"cooked-list-settings"},Se=["value"],be=n("span",null,"or",-1),Ie={key:0,class:"cooked-search-result"},De={key:1,class:"cooked-list"},Le={class:"header"},Ve=n("span",{class:"cooked-name"},null,-1),xe=n("span",{class:"cooked-date"},"Date",-1),Pe={class:"list"},Te={class:"cooked-name"},Ne={class:"cooked-date"},Re=["onClick"],Ue=["onClick"],Ee=["onClick"],Me=["onClick"],We=["onClick"],Be={setup(a){const t=ht(),e=G([{text:"Show the last:",value:0},{text:"5",value:5},{text:"10",value:10},{text:"15",value:15},{text:"30",value:30}]);let l;const s=["Kcal","Prots","Fats","Carbs"],d=x([]),v=x("");P(v,i=>{i&&setTimeout(()=>v.value="",2e3)});const k=R(()=>t.cookedList.length==0);P(()=>t.cookedList.length,(i,y)=>{i>l&&l!=0&&(t.cookedList.shift(),d.value.shift()),i-y==1?d.value.push(!1):y==0&&t.cookedList.forEach(()=>d.value.push(!1))}),P(()=>t.cookedFormHeight,i=>{const y=document.querySelector(".cooked-list-settings");y.style.top=i+62+"px",N(i)}),P(k,async i=>{i||(await ct(),N(t.cookedFormHeight))});function N(i){const y=document.querySelector(".cooked-list .header");if(y){y.style.top=i+62+37+"px";const g=document.querySelector(".cooked-list");g.style.marginTop=i+62+37+34+"px"}}function F(){e[0].value==0&&e.shift()}function S(i){l=i.target.value,b(l),I()}async function b(i){const y=`/api/cooked/last/${i}`;t.cookedList=await V.get(y)}function I(){k.value&&(v.value="Nothing to show")}function w(i){const y=i.target.value;y.length<2?(t.cookedList=[],l=0):h(y)}async function h(i){const y=`/api/cooked/matches/${i}`;t.cookedList=await V.get(y),I()}async function u(i){if(i.ingridients)return;const g=`/api/cooked/ingrs/${i.id}`;i.ingridients=await V.get(g)}function m(i){d.value[i]=!0}function D(i){d.value[i]=!1}async function W(i){await u(i),t.editableCooked=i,t.editCookedFlag=!0}async function O(i,y){if(!confirm("Do you really want delete it?"))return;const U=`/api/cooked/${i.id}`,B=await V.delete(U);j(B,i,y)}function j(i,y,g){i=="ER_ROW_IS_REFERENCED"?alert("Can't be deleted due to presence as ingridient or in eaten food"):i==1&&(H(y,g),K())}function H(i,y){d.value=d.value.filter((g,U)=>U!=y),t.cookedList=t.cookedList.filter(g=>g!=i)}async function K(){if(l==0)return;const y=`/api/cooked/first/${l}`,g=await V.get(y);t.cookedList.unshift(g)}async function A(i){await u(i),t.editableCooked=i,t.baseCookedFlag=!0}return(i,y)=>(r(),c(L,null,[n("div",Fe,[n("select",{onChange:y[0]||(y[0]=g=>S(g)),onFocus:F},[(r(!0),c(L,null,T(C(e),g=>(r(),c("option",{key:g.value,value:g.value},_(g.text),9,Se))),128))],32),be,n("input",{class:"search",type:"text",placeholder:"search...",maxlength:"64",onInput:y[1]||(y[1]=g=>w(g))},null,32)]),C(k)?(r(),c("p",Ie,_(v.value),1)):(r(),c("div",De,[n("div",Le,[Ve,xe,(r(),c(L,null,T(s,g=>n("span",null,_(g),1)),64))]),n("div",Pe,[(r(!0),c(L,null,T(C(t).cookedList,(g,U)=>(r(),c("div",{class:"cooked-item",key:g.food_id},[n("span",Te,_(g.name),1),n("span",Ne,_(new Date(Date.parse(g.date)).toDateString()),1),n("span",null,_(g.kcal),1),n("span",null,_(g.proteins),1),n("span",null,_(g.fats),1),n("span",null,_(g.carbohydrates),1),d.value[U]?(r(),c("button",{key:0,onClick:B=>D(U)}," Hide ",8,Re)):(r(),c("button",{key:1,onClick:B=>(u(g),m(U))}," Ingrs. ",8,Ue)),n("button",{onClick:B=>W(g)}," Edit ",8,Ee),n("button",{onClick:B=>O(g,U)}," Delete ",8,Me),n("button",{onClick:B=>A(g)}," Base ",8,We),d.value[U]?(r(),mt(Ce,{key:2,foodList:g.ingridients},null,8,["foodList"])):J("",!0)]))),128))])]))],64))}};function st(a){let t=a.target.value;return t=parseInt(t),isNaN(t)?"":t}function it(a){const t={};return Object.assign(t,a),t.kcal_1=a.nutrValues1[0],t.proteins_1=a.nutrValues1[1],t.fats_1=a.nutrValues1[2],t.carbohydrates_1=a.nutrValues1[3],delete t.id,delete t.nutrValues1,t}function pt(a){const t=[];for(let e of a)e.id&&e.id!==null&&e.weight>0&&t.push({ingrId:e.id,ingrWeight:e.weight});return t}function ut(a,t=!1){const e={},l=gt(a.nutrValues1);return e.name=a.name,e.weight=a.weight,e.kcal=l[0],e.proteins=l[1],e.fats=l[2],e.carbohydrates=l[3],t||(e.id=a.id,e.date=a.date),e}function gt(a){return a.map(t=>+(t*100).toFixed(2))}function _t(a){const t=Oe(a);for(let e of t)Object.assign(e,e.nutrValues1),delete e.listId,delete e.nutrValues1,delete e.nutrValuesW;return t}function Oe(a){const t=new Set(a);for(let e of t)e.nutrValuesW||t.delete(e);return Array.from(t)}async function Ae(a,t,e){const l=je(a,t,e);if(l=="nothing")return"Nothing changed";if(l=="cooked"){const s=await Ge(t);return Ze(s,a,t)}if(l=="whole"){const s=await Qe(t,e);return Xe(s,a,t,e)}}function je(a,t,e){const l=He(a,t);let s=!1;return Ke(a,e)?s=!0:s=ze(a,e),Je(l,s)}function He(a,t){return a.name!=t.name||a.weight!=t.weight}function Ke(a,t){return a.ingridients.length!=qe(t)}function qe(a){let t=0;for(let e of a)e.nutrValuesW&&t++;return t}function ze(a,t){const e=Array.from(t),l=a.ingridients;for(let s of l){const d=e.find(v=>v.id==s.id);if(!d||d.weight!=s.weight)return!0}return!1}function Je(a,t){return a&&t||t?"whole":a?"cooked":"nothing"}function Ge(a){const e=`/api/cooked/${a.id}`,l=it(a);return delete l.date,V.patch(e,l)}function Ze(a,t,e){if(a==0)return"Nothing changed";if(a==1)return Object.assign(t,ut(e,!0)),"Changes were saved"}function Qe(a,t){const l=`/api/cooked/whole/${a.id}`,s=it(a);return delete s.date,s.ingridients=pt(t),V.patch(l,s)}function Xe(a,t,e,l){if(a){if(a)return Object.assign(t,ut(e,!0)),t.ingridients=_t(l),"Changes were saved"}else return"Changes weren't saved"}const Ye=["value"],tn=["value"],en={key:0,class:"matches"},nn=["onClick"],on={props:["chosenIds","id","name","weight","nutrValues1","nutrValuesW"],emits:["update:id","update:name","update:weight","update:nutrValues1","update:nutrValuesW","ingridientIsFull","ingridientIsEmptied"],setup(a,{emit:t}){const e=a,l=x(null),s=x([]),d=R(()=>{if(!v.value)return["-","-","-","-"];const u=[],m=e.nutrValues1,D=e.weight;for(let W in m)u.push(+(m[W]*D).toFixed(2));return t("update:nutrValuesW",u),u}),v=R(()=>{const u=e.nutrValues1,m=e.weight;return u?"kcal_1"in u&&m>0:!1}),k=R(()=>{const u=[];for(let m of s.value)e.chosenIds.includes(m.id)||u.push(m);return u});P(v,u=>{u&&t("ingridientIsFull")}),P(d,u=>{u.includes("-")?t("update:nutrValuesW",null):t("update:nutrValuesW",u)});function N(u){const m=u.target.value;if(m.length<2){s.value=[];return}else F(m)}async function F(u){const m=`/api/food/matches/${u}`;s.value=await V.get(m)}function S(){e.id&&(t("update:id",null),t("update:nutrValues1",null))}function b(){e.name==""&&e.weight==""&&e.id===null&&t("ingridientIsEmptied")}function I(u){l.value.value=st(u)}function w(u){t("update:name",u.name),t("update:id",u.id),s.value=[],l.value.focus(),h(u.id)}async function h(u){const m=await V.get(`/api/food/data/${u}`);t("update:nutrValues1",m)}return(u,m)=>(r(),c(L,null,[n("input",{class:"name",type:"text",placeholder:"name",maxlength:"64",value:a.name,onInput:m[0]||(m[0]=D=>(u.$emit("update:name",D.target.value),N(D),S())),onFocusout:b},null,40,Ye),n("input",{class:"weight",type:"text",ref_key:"weightInputRef",ref:l,placeholder:"weight",maxlength:"4",value:a.weight,onInput:m[1]||(m[1]=D=>(u.$emit("update:weight",C(st)(D)),I(D))),onFocusout:b},null,40,tn),(r(!0),c(L,null,T(C(d),D=>(r(),c("span",null,_(D),1))),256)),s.value.length?(r(),c("ul",en,[(r(!0),c(L,null,T(C(k),D=>(r(),c("li",{onClick:W=>w(D)},_(D.name),9,nn))),256))])):J("",!0)],64))}};const sn={class:"cooked-form-background"},an={class:"cooked-form"},ln=n("p",{class:"header"},"Ingridients:",-1),un={class:"ingridients"},rn={class:"header"},dn=n("span",{class:"indent"},null,-1),cn=["onClick"],fn={class:"ingridients-total"},hn=n("hr",null,null,-1),pn=n("span",{class:"indent"},"Nutritional value (per 100g):",-1),gn={class:"form-buttons"},_n={class:"result-message"},vn=n("hr",null,null,-1),mn={setup(a){const t=ht(),e=G({id:"",name:"",weight:"",nutrValues1:[],date:new Date().toDateString()}),l=G(new Set),s=["Kcal","Prots","Fats","Carbs"],d=[!1],v=x("Submit"),k=x("Clean");let N=0;const F=x("");P(F,o=>{o&&setTimeout(()=>F.value="",2e3)}),Q(()=>{u(),document.getElementById("cook-link").classList.add("current"),t.editCookedFlag=!1,t.baseCookedFlag=!1});const S=R(()=>{const o=[];for(let p of l)p.id&&p.id!==null&&o.push(p.id);return o}),b=R(()=>{if(I.value)return!1;for(let o of l){if(o.name==""||o.weight=="")return!1;if(!o.id)return!1}return!0}),I=R(()=>l.size==20),w=R(()=>{const o=m();return D(o)||e.weight==""?!1:o.map(p=>+(p/=e.weight).toFixed(4))}),h=R(()=>w.value?gt(w.value):["-","-","-","-"]);P(()=>l.size,async(o,p)=>{o>p&&o!=1?d.unshift(!0):o<p&&d.shift(),W()}),P(w,o=>{o?e.nutrValues1=o:e.nutrValues1=[]}),P(()=>t.editCookedFlag,o=>{if(!o){v.value="Submit",k.value="Clean";return}O(),v.value="Save",k.value="Cancel"}),P(()=>t.baseCookedFlag,o=>{o&&(O(!0),t.baseCookedFlag=!1)});function u(){l.add({listId:N++})}function m(){const o=[0,0,0,0];for(let p of l)if(!!p.nutrValuesW)for(let $=0;$<4;$++)o[$]+=p.nutrValuesW[$];return o}function D(o){let p=!1;for(let $ of o)$==0&&(p=!0);return p}async function W(){await ct();const o=document.querySelector(".cooked-form-background");t.cookedFormHeight=o.offsetHeight}function O(o=!1){o||(e.id=t.editableCooked.id),e.name=t.editableCooked.name,e.weight=t.editableCooked.weight,j()}function j(){l.clear();for(let o of t.editableCooked.ingridients)l.add({listId:N++,id:o.id,name:o.name,weight:o.weight,nutrValues1:H(o)});u()}function H(o){return{kcal_1:o.kcal_1,proteins_1:o.proteins_1,fats_1:o.fats_1,carbohydrates_1:o.carbohydrates_1}}function K(){if(I.value){F.value="Ingridients cap reached";return}b.value&&u()}function A(o){l.delete(o)}async function i(){if(!!y()&&!!g())if(t.editCookedFlag){const o=await Ae(t.editableCooked,e,l);U(o)}else{const o=await B();et(o)}}function y(){return h.value[0]>1e3?(F.value="Too many calories. Check your data",!1):h.value[1]>100?(F.value="Too many proteins. Check your data",!1):h.value[2]>100?(F.value="Too many fats. Check your data",!1):h.value[3]>100?(F.value="Too many carbohydrates. Check your data",!1):!0}function g(){return e.name!=""&&e.weight!=0&&l.size>1?!0:(F.value="Not enough data",!1)}function U(o){F.value=o,o=="Changes were saved"&&(Z(),t.editCookedFlag=!1)}function B(){const o="/api/cooked",p=pt(l),$=it(e);return $.ingridients=p,V.post(o,$)}function et(o){o===!1?F.value="Cooked wasn't added":(F.value="Cooked was added",e.id=o,nt(),Z())}function nt(){const o=ut(e);o.ingridients=_t(l),t.cookedList.push(o)}function Z(){e.id="",e.name="",e.weight="",e.nutrValues1=[],l.clear(),u()}function f(){t.editCookedFlag=!1,Z()}return(o,p)=>(r(),c("div",sn,[n("div",an,[q(n("input",{class:"name",type:"text",ref:"cookedNameInputRef",placeholder:"cooked thing name",maxlength:"64","onUpdate:modelValue":p[0]||(p[0]=$=>C(e).name=$)},null,512),[[z,C(e).name]]),q(n("input",{class:"weight",type:"text",placeholder:"weight",maxlength:"4",onInput:p[1]||(p[1]=$=>C(e).weight=C(st)($)),"onUpdate:modelValue":p[2]||(p[2]=$=>C(e).weight=$)},null,544),[[z,C(e).weight]]),ln,n("div",un,[n("div",rn,[dn,(r(),c(L,null,T(s,$=>n("span",null,_($),1)),64))]),(r(!0),c(L,null,T(C(l),($,X)=>(r(),c("div",{class:"ingridient",key:$.listId},[E(on,{chosenIds:C(S),id:$.id,"onUpdate:id":M=>$.id=M,name:$.name,"onUpdate:name":M=>$.name=M,weight:$.weight,"onUpdate:weight":M=>$.weight=M,nutrValues1:$.nutrValues1,"onUpdate:nutrValues1":M=>$.nutrValues1=M,nutrValuesW:$.nutrValuesW,"onUpdate:nutrValuesW":M=>$.nutrValuesW=M,onIngridientIsFull:K,onIngridientIsEmptied:M=>A($)},null,8,["chosenIds","id","onUpdate:id","name","onUpdate:name","weight","onUpdate:weight","nutrValues1","onUpdate:nutrValues1","nutrValuesW","onUpdate:nutrValuesW","onIngridientIsEmptied"]),d[X]||$.id?(r(),c("button",{key:0,onClick:M=>A($)}," Delete ",8,cn)):J("",!0)]))),128))]),n("div",fn,[hn,pn,(r(!0),c(L,null,T(C(h),$=>(r(),c("span",null,_($),1))),256))]),n("div",gn,[n("button",{onClick:i},_(v.value),1),n("button",{onClick:f},_(k.value),1)]),n("p",_n,_(F.value),1)]),vn]))}};const yn={class:"date-interval"},kn=n("span",{class:"interval-label"},"From: ",-1),wn={class:"from"},$n=n("span",{class:"interval-label"},"To: ",-1),Cn={class:"to"},Fn={key:0,class:"no-total-stat"},Sn={key:1,class:"total-stat-list"},bn={class:"header"},In=n("span",{class:"date"},"Date",-1),Dn={class:"total-stat-item"},Ln={class:"date"},Vn={setup(a){const t=x(null),e=x(new Date),l=x([]),s=x(!1),d=["Kcal","Prots","Fats","Carbs"];Q(()=>{v(),k(),document.getElementById("tot-link").classList.add("current")}),P(t,S=>{S>e.value&&(t.value=e.value),k()}),P(e,S=>{S<t.value&&(t.value=e.value),k()});function v(){const S=e.value.getDate()-10,b=new Date;b.setDate(S),t.value=b}async function k(){const S=t.value.toDateString(),b=e.value.toDateString(),I=`/api/totalstat/${S}/${b}`,w=await V.get(I);N(w)}function N(S){S.length>0?(l.value=S,F(),s.value=!1):s.value=!0}function F(){let S=[];S=l.value.map(b=>new Date(Date.parse(b.date)).toDateString());for(let b=0;b<S.length;b++)l.value[b].date=S[b]}return(S,b)=>(r(),c(L,null,[n("div",yn,[kn,n("div",wn,[E(C(ot),{modelValue:t.value,"onUpdate:modelValue":b[0]||(b[0]=I=>t.value=I),"input-format":"yyyy MMM dd"},null,8,["modelValue"])]),$n,n("div",Cn,[E(C(ot),{modelValue:e.value,"onUpdate:modelValue":b[1]||(b[1]=I=>e.value=I),"input-format":"yyyy MMM dd"},null,8,["modelValue"])])]),s.value?(r(),c("p",Fn," No data on this period ")):(r(),c("div",Sn,[n("div",bn,[In,(r(),c(L,null,T(d,I=>n("span",null,_(I),1)),64))]),(r(!0),c(L,null,T(l.value,I=>(r(),c("div",Dn,[n("span",Ln,_(I.date),1),n("span",null,_(I.kcal),1),n("span",null,_(I.proteins),1),n("span",null,_(I.fats),1),n("span",null,_(I.carbohydrates),1)]))),256))]))],64))}};var xn=yt({history:kt(),routes:[{path:"/",components:{default:Mt,DatePicker:xt,DayStat:Zt}},{path:"/products",components:{default:ae,ProductList:ve}},{path:"/cooked",components:{default:mn,CookedList:Be}},{path:"/total",component:Vn}]});const rt=wt(Lt);rt.use($t());rt.use(xn);rt.mount("#app");
